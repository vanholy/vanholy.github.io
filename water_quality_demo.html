<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qualit√† dell'Acqua - Comuni di Bergamo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            margin: 10px 0 0 0;
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }

        .section h2 {
            margin-top: 0;
            color: #1976D2;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .search-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 25px;
        }

        .search-container input {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            flex: 1;
            min-width: 250px;
            transition: border-color 0.3s ease;
        }

        .search-container input:focus {
            outline: none;
            border-color: #2196F3;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
        }

        .municipality-section {
            border: 1px solid #e0e0e0;
            margin: 15px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s ease;
        }

        .municipality-section:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .municipality-header {
            padding: 20px;
            background: linear-gradient(135deg, #f5f5f5, #eeeeee);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .municipality-header:hover {
            background: linear-gradient(135deg, #eeeeee, #e0e0e0);
        }

        .municipality-header h4 {
            margin: 0;
            color: #1976D2;
            font-size: 1.2em;
            text-transform: capitalize;
            font-weight: 500;
        }

        .toggle-icon {
            font-size: 20px;
            color: #666;
            transition: transform 0.3s ease;
        }

        .municipality-content {
            padding: 25px;
            background: white;
        }

        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .parameter-table thead tr {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .parameter-table th,
        .parameter-table td {
            padding: 12px 15px;
            text-align: left;
            border: none;
        }

        .parameter-table th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 0.5px;
        }

        .parameter-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        .parameter-table tbody tr:hover {
            background: #e3f2fd;
        }

        .parameter-table td:nth-child(2) {
            font-weight: bold;
            text-align: center;
            color: #1976D2;
        }

        .parameter-table td:nth-child(3),
        .parameter-table td:nth-child(4) {
            text-align: center;
        }

        .above-limit {
            background-color: #ffebee !important;
            border-left: 4px solid #f44336;
        }

        .stats-summary {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }

        .stats-summary h4 {
            margin-top: 0;
            color: #1976D2;
            font-size: 1.2em;
        }

        .stats-summary p {
            margin: 8px 0;
            color: #333;
        }

        .parameter-select {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            margin-right: 15px;
            min-width: 250px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .parameter-select:focus {
            outline: none;
            border-color: #FF9800;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1em;
            color: #666;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 0;
            }

            .content {
                padding: 20px 15px;
            }

            .section {
                padding: 20px 15px;
            }

            .search-container {
                flex-direction: column;
                align-items: stretch;
            }

            .search-container input {
                min-width: auto;
                margin-bottom: 10px;
            }

            .btn {
                width: 100%;
                margin: 5px 0;
            }

            .parameter-table {
                font-size: 14px;
            }

            .parameter-table th,
            .parameter-table td {
                padding: 8px 10px;
            }

            .municipality-header {
                padding: 15px;
            }

            .municipality-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Qualit√† dell'Acqua</h1>
            <p>Analisi dei parametri di qualit√† dell'acqua per 215 comuni della provincia di Bergamo</p>
        </div>

        <div class="content">
            <!-- Search Section -->
            <div class="section">
                <h2>üîç Ricerca Comuni</h2>
                <div id="search-interface">
                    <div class="search-container">
                        <input type="text"
                               id="municipality-search"
                               placeholder="Inserisci il nome del comune (es. Bergamo, Albino...)">
                        <button onclick="WaterQualityUI.performSearch()"
                                class="btn btn-primary">
                            Cerca
                        </button>
                        <button onclick="WaterQualityUI.showAllMunicipalities()"
                                class="btn btn-success">
                            Mostra tutti
                        </button>
                    </div>
                </div>
                <div id="search-results" class="loading">
                    Caricamento dati in corso...
                </div>
            </div>

            <!-- Parameter Comparison Section -->
            <div class="section">
                <h2>üìä Confronto Parametri</h2>
                <div id="parameter-comparison">
                    <div style="margin-bottom: 20px;">
                        <select id="parameter-select" class="parameter-select">
                            <option value="">Seleziona un parametro da confrontare</option>
                        </select>
                        <button onclick="WaterQualityUI.compareParameter()"
                                class="btn btn-warning">
                            Confronta
                        </button>
                    </div>
                </div>
                <div id="comparison-results"></div>
            </div>

            <!-- Information Section -->
            <div class="section">
                <h2>‚ÑπÔ∏è Informazioni sui Dati</h2>
                <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #e0e0e0;">
                    <h4>Fonte dei Dati</h4>
                    <p><strong>UniAcque S.p.A.</strong> - Azienda per i Servizi Idrici Integrati</p>
                    <p><strong>Data estrazione:</strong> 16 settembre 2025</p>
                    <p><strong>Comuni analizzati:</strong> 215</p>

                    <h4>Parametri Monitorati</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 15px;">
                        <div>‚Ä¢ pH (acidit√†/basicit√†)</div>
                        <div>‚Ä¢ Residuo fisso</div>
                        <div>‚Ä¢ Durezza totale</div>
                        <div>‚Ä¢ Conducibilit√† elettrica</div>
                        <div>‚Ä¢ Calcio</div>
                        <div>‚Ä¢ Magnesio</div>
                        <div>‚Ä¢ Ammonio</div>
                        <div>‚Ä¢ Cloruro</div>
                        <div>‚Ä¢ Solfato</div>
                        <div>‚Ä¢ Potassio</div>
                        <div>‚Ä¢ Sodio</div>
                        <div>‚Ä¢ Arsenico</div>
                        <div>‚Ä¢ Bicarbonato</div>
                        <div>‚Ä¢ Cloro residuo libero</div>
                        <div>‚Ä¢ Fluoruri</div>
                        <div>‚Ä¢ Nitrato</div>
                        <div>‚Ä¢ Nitrito</div>
                        <div>‚Ä¢ Manganese</div>
                    </div>

                    <h4>Legenda</h4>
                    <p><strong>üî¥ Righe evidenziate in rosso:</strong> Valori che superano i limiti normativi</p>
                    <p><strong>Valori con simboli < >:</strong> Valori al di sotto/sopra la soglia di rilevamento strumentale</p>
                    <p><strong>Campi vuoti nei limiti:</strong> Parametro senza limite normativo specifico</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Load the water quality data -->
    <script src="water_quality_data.js"></script>

    <!-- Additional initialization -->
    <script>
        // Initialize the interface when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Set up search functionality
            const searchInput = document.getElementById('municipality-search');
            if (searchInput) {
                // Add real-time search on typing
                searchInput.addEventListener('input', function() {
                    if (this.value.length >= 2) {
                        WaterQualityUI.performSearch();
                    } else if (this.value.length === 0) {
                        WaterQualityUI.showAllMunicipalities();
                    }
                });

                // Add enter key support
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        WaterQualityUI.performSearch();
                    }
                });
            }

            // Populate parameter selection dropdown
            const paramSelect = document.getElementById('parameter-select');
            if (paramSelect && typeof WaterQualityHelper !== 'undefined') {
                const parameters = WaterQualityHelper.getAllParameters();
                parameters.forEach(param => {
                    const option = document.createElement('option');
                    option.value = param;
                    option.textContent = param;
                    paramSelect.appendChild(option);
                });
            }

            // Show all municipalities by default
            if (typeof WaterQualityUI !== 'undefined') {
                setTimeout(() => {
                    console.log('Showing all municipalities...');
                    WaterQualityUI.showAllMunicipalities();
                }, 100);
            } else {
                console.error('WaterQualityUI not loaded');
                document.getElementById('search-results').innerHTML = `
                    <div class="no-results">
                        <p>Errore nel caricamento dei dati. Assicurati che il file water_quality_data.js sia presente e correttamente caricato.</p>
                    </div>
                `;
            }
        });

        // Enhanced toggle function with smooth animation
        WaterQualityUI.toggleMunicipality = function(sectionId) {
            const content = document.getElementById(sectionId);
            const icon = document.getElementById('icon-' + sectionId);

            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
                icon.style.transform = 'rotate(180deg)';
                // Smooth scroll to the opened section
                content.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
                icon.style.transform = 'rotate(0deg)';
            }
        };
    </script>
</body>
</html>